tb.private.library = [
	{ "title": "40 Years Later", "location": "http://download.blender.org/demo/movies/ToS/Tears-Of-Steel-OST/01%2040%20years%20later.mp3", "artwork": "packages/albums/placeholders/tears_of_steel.png", "artists": ["Joram Letwory"], "album": "Tears of Steel", "year": 2012, "track": 1, "disk": 1, "time": 31, "id": 0 },
	{ "title": "The Dome", "location": "http://download.blender.org/demo/movies/ToS/Tears-Of-Steel-OST/02%20The%20dome.mp3", "artwork": "packages/albums/placeholders/tears_of_steel.png", "artists": ["Joram Letwory"], "album": "Tears of Steel", "year": 2012, "track": 2, "disk": 1, "time": 311, "id": 1 },
	{ "title": "The Battle", "location": "http://download.blender.org/demo/movies/ToS/Tears-Of-Steel-OST/03%20The%20battle.mp3", "artwork": "packages/albums/placeholders/tears_of_steel.png", "artists": ["Joram Letwory"], "album": "Tears of Steel", "year": 2012, "track": 3, "disk": 1, "time": 123, "id": 2 },
	{ "title": "End Credits", "location": "http://download.blender.org/demo/movies/ToS/Tears-Of-Steel-OST/04%20End%20credits.mp3", "artwork": "packages/albums/placeholders/tears_of_steel.png", "artists": ["Joram Letwory"], "album": "Tears of Steel", "year": 2012, "track": 4, "disk": 1, "time": 103, "id": 3 },

	{ "title": "The Wires", "location": "http://download.blender.org/ED/1-TheWires.mp3", "artwork": "packages/albums/placeholders/elephants_dream.jpg", "artists": ["Jan Morgenstern"], "album": "Elephants Dream", "year": 2006, "track": 1, "disk": 1, "time": 75, "id": 4 },
	{ "title": "Typewriter Dance", "location": "http://download.blender.org/ED/2-TypewriterDance.mp3", "artwork": "packages/albums/placeholders/elephants_dream.jpg", "artists": ["Jan Morgenstern"], "album": "Elephants Dream", "year": 2006, "track": 2, "disk": 1, "time": 70, "id": 5 },
	{ "title": "The Safest Place", "location": "http://download.blender.org/ED/3-TheSafestPlace.mp3", "artwork": "packages/albums/placeholders/elephants_dream.jpg", "artists": ["Jan Morgenstern"], "album": "Elephants Dream", "year": 2006, "track": 3, "disk": 1, "time": 45, "id": 6 },
	{ "title": "Emo Creates", "location": "http://download.blender.org/ED/4-EmoCreates.mp3", "artwork": "packages/albums/placeholders/elephants_dream.jpg", "artists": ["Jan Morgenstern"], "album": "Elephants Dream", "year": 2006, "track": 4, "disk": 1, "time": 60, "id": 7 },
	{ "title": "End Title", "location": "http://download.blender.org/ED/5-EndTitle.mp3", "artwork": "packages/albums/placeholders/elephants_dream.jpg", "artists": ["Jan Morgenstern"], "album": "Elephants Dream", "year": 2006, "track": 5, "disk": 1, "time": 91, "id": 8 },
	{ "title": "Teaser Music", "location": "http://download.blender.org/ED/6-TeaserMusic.mp3", "artwork": "packages/albums/placeholders/elephants_dream.jpg", "artists": ["Jan Morgenstern"], "album": "Elephants Dream", "year": 2006, "track": 6, "disk": 1, "time": 75, "id": 9 },
	{ "title": "Ambience", "location": "http://download.blender.org/ED/7-Ambience.mp3", "artwork": "packages/albums/placeholders/elephants_dream.jpg", "artists": ["Jan Morgenstern"], "album": "Elephants Dream", "year": 2006, "track": 7, "disk": 1, "time": 110, "id": 10 },

	{ "title": "Snow Fight", "location": "https://archive.org/download/Sintel_Original_Film_Score-9838/Jan_Morgenstern_-_01_-_Snow_Fight.mp3", "artwork": "packages/albums/placeholders/sintel.jpg", "artists": ["Jan Morgenstern"], "album": "Sintel", "year": 2010, "track": 1, "disk": 1, "time": 107, "id": 11 },
	{ "title": "Finding Scales / Chicken Run", "location": "https://archive.org/download/Sintel_Original_Film_Score-9838/Jan_Morgenstern_-_02_-_Finding_Scales__Chicken_Run.mp3", "artwork": "packages/albums/placeholders/sintel.jpg", "artists": ["Jan Morgenstern"], "album": "Sintel", "year": 2010, "track": 2, "disk": 1, "time": 107, "id": 12 },
	{ "title": "The Ziggurat", "location": "https://archive.org/download/Sintel_Original_Film_Score-9838/Jan_Morgenstern_-_03_-_The_Ziggurat.mp3", "artwork": "packages/albums/placeholders/sintel.jpg", "artists": ["Jan Morgenstern"], "album": "Sintel", "year": 2010, "track": 3, "disk": 1, "time": 78, "id": 13 },
	{ "title": "Expedition", "location": "https://archive.org/download/Sintel_Original_Film_Score-9838/Jan_Morgenstern_-_04_-_Expedition.mp3", "artwork": "packages/albums/placeholders/sintel.jpg", "artists": ["Jan Morgenstern"], "album": "Sintel", "year": 2010, "track": 4, "disk": 1, "time": 93, "id": 14 },
	{ "title": "Dragon Blood Tree", "location": "https://archive.org/download/Sintel_Original_Film_Score-9838/Jan_Morgenstern_-_05_-_Dragon_Blood_Tree.mp3", "artwork": "packages/albums/placeholders/sintel.jpg", "artists": ["Jan Morgenstern"], "album": "Sintel", "year": 2010, "track": 5, "disk": 1, "time": 47, "id": 15 },
	{ "title": "Cave Fight / Lament", "location": "https://archive.org/download/Sintel_Original_Film_Score-9838/Jan_Morgenstern_-_06_-_Cave_Fight__Lament.mp3", "artwork": "packages/albums/placeholders/sintel.jpg", "artists": ["Jan Morgenstern"], "album": "Sintel", "year": 2010, "track": 6, "disk": 1, "time": 145, "id": 16 },
	{ "title": "I Move On (Sintel's Song)", "location": "https://archive.org/download/Sintel_Original_Film_Score-9838/Jan_Morgenstern__Performed_by_Helena_Fix_-_07_-_I_Move_On_Sintels_Song.mp3", "artwork": "packages/albums/placeholders/sintel.jpg", "artists": ["Jan Morgenstern"], "album": "Sintel", "year": 2010, "track": 7, "disk": 1, "time": 169, "id": 17 },
	{ "title": "Circling Dragons", "location": "https://archive.org/download/Sintel_Original_Film_Score-9838/Jan_Morgenstern_-_08_-_Circling_Dragons.mp3", "artwork": "packages/albums/placeholders/sintel.jpg", "artists": ["Jan Morgenstern"], "album": "Sintel", "year": 2010, "track": 8, "disk": 1, "time": 28, "id": 18 },
	{ "title": "Trailer Music", "location": "https://archive.org/download/Sintel_Original_Film_Score-9838/Jan_Morgenstern_-_09_-_Trailer_Music.mp3", "artwork": "packages/albums/placeholders/sintel.jpg", "artists": ["Jan Morgenstern"], "album": "Sintel", "year": 2010, "track": 9, "disk": 1, "time": 44, "id": 19 }
];

// Return a read-only copy of the library
tb.getLibrary = function () {
	return tb.cloneObject(tb.private.library);
};

// Finds tracks matching given parameters and returns an array with all matching songs
// Parameters filter the returned objects, which each item in the JSON array checked against every song's metadata to see if it matches
tb.findInLibrary = function (parameters, contains, callback) {
	setTimeout(function () {
		var matchedSongs = [];

		function stringMatches(stringOne, stringTwo) {
			if (contains) {
				if (stringTwo.search(stringOne) >= 0) {
					return true;
				} else {
					return false;
				}
			} else {
				if (stringOne === stringTwo) {
					return true;
				} else {
					return false;
				}
			}
		}

		for (var song in tb.private.library) {
			var matched = true;

			if (parameters.album && matched !== false) {
				if (!stringMatches(parameters.album, tb.private.library[song].album)) {
					matched = false;
				}
			}

			if (parameters.track && matched !== false) {
				if (!stringMatches(parameters.track, tb.private.library[song].track)) {
					matched = false;
				}
			}

			if (parameters.disk && matched !== false) {
				if (!stringMatches(parameters.disk, tb.private.library[song].disk)) {
					matched = false;
				}
			}

			if (parameters.time && matched !== false) {
				if (parameters.time !== tb.private.library[song].time) {
					matched = false;
				}
			}

			if (parameters.location && matched !== false) {
				if (!stringMatches(parameters.location, tb.private.library[song].location)) {
					matched = false;
				}
			}

			if (parameters.year && matched !== false) {
				if (!stringMatches(parameters.year, tb.private.library[song].year)) {
					matched = false;
				}
			}

			if (parameters.id) {
				console.error("To find by id, use tb.findById");
			}

			if (parameters.title && matched !== false) {
				if (!stringMatches(parameters.title, tb.private.library[song].title)) {
					matched = false;
				}
			}

			if (parameters.artists && matched !== false) {
				// Check if the selected artist in parameters matches one of the artists in selected song in the library.
				for (var artist in parameters.artists) {
					var songMatched = false;

					for (var libraryArtist in tb.private.library[song].artists) {
						if (!stringMatches(parameters.artists[artist], tb.private.library[song].artists[libraryArtist])) {
							songMatched = true;
						}
					}
					if (songMatched !== true) {
						matched = false;
					}

					if (matched === false) {
						break;
					}
				}
			}

			if (matched === true) {
				// If the song matched, send it to the calling function.
				matchedSongs.push(tb.private.library[song]);
			}
		}
		callback(tb.cloneObject(matchedSongs));
	}, 0);
};

tb.findById = function (id, callback) {
	setTimeout(function () {
		var searchPosition = 0;

		if (id < 0) {
			console.error("tb.findById: ID must always be greater than or equal to zero");
			callback(null);
			return;
		}

		// Determine the starting position of the search;
		if (id >= (tb.private.library.length - 1)) {
			searchPosition = tb.private.library.length - 1;
		} else {
			searchPosition = id;
		}

		var lastId = tb.private.library[searchPosition].id;

		while (true) {
			var currentId = tb.private.library[searchPosition].id;
			if (currentId === id) {
				callback(tb.cloneObject(tb.private.library[searchPosition]));
				break;
			} else if ((lastId > id && id > currentId) || (lastId < id && id < currentId)) {
				callback(null);
				break;
			} else if (currentId > id) {
				searchPosition--;
			} else if (currentId < id) {
				searchPosition++;
			} else {
				callback(null);
				console.error("Issue in tb.findById: Caught an infinite loop edge case");
				break;
			}

			if (searchPosition > (tb.private.library.length - 1) || searchPosition < 0) {
				callback(null);
				break;
			}

			lastId = currentId;
		}
	}, 0);
};

// Returns a function with logic to sort an array in ascending or descending order based on given properties
// http://stackoverflow.com/a/25030191/775283
tb.sortByProperties = function (sortProperties) {
	// Place all arguments in an array
	if (!(sortProperties instanceof Array)) {
		sortProperties = Array.prototype.slice.call(arguments);
	}
	return function (a, b) {
		// Go through every sort property
		for (var i = 0; i < sortProperties.length; ++i) {
			// Remove the - or + prefix from the key
			var key = sortProperties[i].substr(1);

			// Store the first character to determine the + or - prefix
			var order = sortProperties[i].substr(0, 1);

			// If the first character was not + or - then default to + and add the first character back to the key
			if (order !== '-' && order !== '+') {
				key = sortProperties[i];
				order = '+';
			}

			// Sort logic
			if (a[key] !== b[key]) {
				if (a[key] === undefined) { return 1; }
				if (b[key] === undefined) { return -1; }
				if (typeof a[key] === 'string' || typeof b[key] === 'string') {
					return (order === '+' ? String(a[key]).toLowerCase() < String(b[key]).toLowerCase() : String(a[key]).toLowerCase() > String(b[key]).toLowerCase()) ? -1 : 1;
				} else {
					return (order === '+' ? a[key] < b[key] : a[key] > b[key]) ? -1 : 1;
				}
			}
		}
		return 0;
	};
};
